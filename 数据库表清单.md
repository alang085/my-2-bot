# æ•°æ®åº“è¡¨æ¸…å•

æ ¹æ® `init_db.py` åˆå§‹åŒ–è„šæœ¬ï¼Œå½“å‰æ•°æ®åº“åŒ…å«ä»¥ä¸‹ **11 ä¸ªè¡¨**ï¼š

## ğŸ“Š æ ¸å¿ƒä¸šåŠ¡è¡¨

### 1. **orders** - è®¢å•è¡¨
**ç”¨é€”**ï¼šå­˜å‚¨æ‰€æœ‰è®¢å•ä¿¡æ¯

**å­—æ®µ**ï¼š
- `id` - ä¸»é”®ï¼ˆè‡ªå¢ï¼‰
- `order_id` - è®¢å•ç¼–å·ï¼ˆå”¯ä¸€ï¼Œéç©ºï¼‰
- `group_id` - å½’å±IDï¼ˆéç©ºï¼‰
- `chat_id` - Telegramç¾¤ç»„IDï¼ˆéç©ºï¼‰
- `date` - è®¢å•æ—¥æœŸï¼ˆéç©ºï¼‰
- `weekday_group` - æ˜ŸæœŸåˆ†ç»„ï¼ˆéç©ºï¼‰
- `customer` - å®¢æˆ·ç±»å‹ï¼ˆA=æ–°å®¢æˆ·ï¼ŒB=è€å®¢æˆ·ï¼Œéç©ºï¼‰
- `amount` - è®¢å•é‡‘é¢ï¼ˆéç©ºï¼‰
- `state` - è®¢å•çŠ¶æ€ï¼ˆnormal/overdue/breach/end/breach_endï¼Œéç©ºï¼‰
- `created_at` - åˆ›å»ºæ—¶é—´
- `updated_at` - æ›´æ–°æ—¶é—´

---

### 2. **financial_data** - å…¨å±€è´¢åŠ¡æ•°æ®è¡¨
**ç”¨é€”**ï¼šå­˜å‚¨å…¨å±€ç´¯è®¡ç»Ÿè®¡æ•°æ®ï¼ˆå•æ¡è®°å½•ï¼‰

**å­—æ®µ**ï¼š
- `id` - ä¸»é”®ï¼ˆè‡ªå¢ï¼‰
- `valid_orders` - æœ‰æ•ˆè®¢å•æ•°
- `valid_amount` - æœ‰æ•ˆè®¢å•é‡‘é¢
- `liquid_funds` - æµåŠ¨èµ„é‡‘ä½™é¢
- `new_clients` - æ–°å®¢æˆ·æ•°
- `new_clients_amount` - æ–°å®¢æˆ·è®¢å•é‡‘é¢
- `old_clients` - è€å®¢æˆ·æ•°
- `old_clients_amount` - è€å®¢æˆ·è®¢å•é‡‘é¢
- `interest` - åˆ©æ¯æ”¶å…¥
- `completed_orders` - å®Œæˆè®¢å•æ•°
- `completed_amount` - å®Œæˆè®¢å•é‡‘é¢
- `breach_orders` - è¿çº¦è®¢å•æ•°
- `breach_amount` - è¿çº¦è®¢å•é‡‘é¢
- `breach_end_orders` - è¿çº¦å®Œæˆè®¢å•æ•°
- `breach_end_amount` - è¿çº¦å®Œæˆè®¢å•é‡‘é¢
- `updated_at` - æ›´æ–°æ—¶é—´

---

### 3. **grouped_data** - åˆ†ç»„æ•°æ®è¡¨
**ç”¨é€”**ï¼šæŒ‰å½’å±IDåˆ†ç»„çš„ç´¯è®¡ç»Ÿè®¡æ•°æ®ï¼ˆæ¯ä¸ªå½’å±IDä¸€æ¡è®°å½•ï¼‰

**å­—æ®µ**ï¼š
- `id` - ä¸»é”®ï¼ˆè‡ªå¢ï¼‰
- `group_id` - å½’å±IDï¼ˆå”¯ä¸€ï¼Œéç©ºï¼‰
- `valid_orders` - æœ‰æ•ˆè®¢å•æ•°
- `valid_amount` - æœ‰æ•ˆè®¢å•é‡‘é¢
- `liquid_funds` - æµåŠ¨èµ„é‡‘ä½™é¢
- `new_clients` - æ–°å®¢æˆ·æ•°
- `new_clients_amount` - æ–°å®¢æˆ·è®¢å•é‡‘é¢
- `old_clients` - è€å®¢æˆ·æ•°
- `old_clients_amount` - è€å®¢æˆ·è®¢å•é‡‘é¢
- `interest` - åˆ©æ¯æ”¶å…¥
- `completed_orders` - å®Œæˆè®¢å•æ•°
- `completed_amount` - å®Œæˆè®¢å•é‡‘é¢
- `breach_orders` - è¿çº¦è®¢å•æ•°
- `breach_amount` - è¿çº¦è®¢å•é‡‘é¢
- `breach_end_orders` - è¿çº¦å®Œæˆè®¢å•æ•°
- `breach_end_amount` - è¿çº¦å®Œæˆè®¢å•é‡‘é¢
- `updated_at` - æ›´æ–°æ—¶é—´

---

### 4. **daily_data** - æ—¥ç»“æ•°æ®è¡¨
**ç”¨é€”**ï¼šæŒ‰æ—¥æœŸå’Œå½’å±IDå­˜å‚¨çš„æ—¥ç»“æµé‡æ•°æ®ï¼ˆç”¨äºç”Ÿæˆå‘¨æœŸæŠ¥è¡¨ï¼‰

**å­—æ®µ**ï¼š
- `id` - ä¸»é”®ï¼ˆè‡ªå¢ï¼‰
- `date` - æ—¥æœŸï¼ˆéç©ºï¼‰
- `group_id` - å½’å±IDï¼ˆå¯ä¸ºNULLè¡¨ç¤ºå…¨å±€æ•°æ®ï¼‰
- `new_clients` - æ–°å®¢æˆ·æ•°
- `new_clients_amount` - æ–°å®¢æˆ·è®¢å•é‡‘é¢
- `old_clients` - è€å®¢æˆ·æ•°
- `old_clients_amount` - è€å®¢æˆ·è®¢å•é‡‘é¢
- `interest` - åˆ©æ¯æ”¶å…¥
- `completed_orders` - å®Œæˆè®¢å•æ•°
- `completed_amount` - å®Œæˆè®¢å•é‡‘é¢
- `breach_orders` - è¿çº¦è®¢å•æ•°
- `breach_amount` - è¿çº¦è®¢å•é‡‘é¢
- `breach_end_orders` - è¿çº¦å®Œæˆè®¢å•æ•°
- `breach_end_amount` - è¿çº¦å®Œæˆè®¢å•é‡‘é¢
- `liquid_flow` - æµåŠ¨èµ„é‡‘æµé‡
- `company_expenses` - å…¬å¸å¼€é”€
- `other_expenses` - å…¶ä»–å¼€é”€
- `updated_at` - æ›´æ–°æ—¶é—´

**çº¦æŸ**ï¼š`UNIQUE(date, group_id)` - æ¯ä¸ªæ—¥æœŸå’Œå½’å±IDçš„ç»„åˆå”¯ä¸€

---

## ğŸ“ æ˜ç»†è®°å½•è¡¨

### 5. **income_records** - æ”¶å…¥æ˜ç»†è¡¨
**ç”¨é€”**ï¼šè®°å½•æ¯ç¬”æ”¶å…¥çš„è¯¦ç»†ä¿¡æ¯ï¼ˆæ”¯æŒå¤šç»´åº¦æŸ¥è¯¢å’Œæ±‡æ€»ï¼‰

**å­—æ®µ**ï¼š
- `id` - ä¸»é”®ï¼ˆè‡ªå¢ï¼‰
- `date` - æ”¶å…¥æ—¥æœŸï¼ˆéç©ºï¼‰
- `type` - æ”¶å…¥ç±»å‹ï¼ˆcompleted/breach_end/interest/principal_reduction/adjustmentï¼Œéç©ºï¼‰
- `amount` - æ”¶å…¥é‡‘é¢ï¼ˆéç©ºï¼‰
- `group_id` - å½’å±IDï¼ˆå¯ä¸ºNULLï¼‰
- `order_id` - å…³è”è®¢å•ç¼–å·ï¼ˆå¯ä¸ºNULLï¼‰
- `order_date` - è®¢å•æ—¥æœŸï¼ˆå¯ä¸ºNULLï¼‰
- `customer` - å®¢æˆ·ç±»å‹ï¼ˆA/Bï¼Œå¯ä¸ºNULLï¼‰
- `weekday_group` - æ˜ŸæœŸåˆ†ç»„ï¼ˆå¯ä¸ºNULLï¼‰
- `note` - å¤‡æ³¨è¯´æ˜ï¼ˆå¯ä¸ºNULLï¼‰
- `created_by` - åˆ›å»ºäººç”¨æˆ·IDï¼ˆå¯ä¸ºNULLï¼‰
- `created_at` - åˆ›å»ºæ—¶é—´

**ç´¢å¼•**ï¼š
- `idx_income_date` - æ—¥æœŸç´¢å¼•
- `idx_income_type` - ç±»å‹ç´¢å¼•
- `idx_income_customer` - å®¢æˆ·ç±»å‹ç´¢å¼•
- `idx_income_group` - å½’å±IDç´¢å¼•
- `idx_income_order` - è®¢å•ç¼–å·ç´¢å¼•
- `idx_income_date_type` - æ—¥æœŸ+ç±»å‹å¤åˆç´¢å¼•
- `idx_income_group_type` - å½’å±ID+ç±»å‹å¤åˆç´¢å¼•

---

### 6. **expense_records** - æ”¯å‡ºæ˜ç»†è¡¨
**ç”¨é€”**ï¼šè®°å½•æ¯ç¬”æ”¯å‡ºçš„è¯¦ç»†ä¿¡æ¯

**å­—æ®µ**ï¼š
- `id` - ä¸»é”®ï¼ˆè‡ªå¢ï¼‰
- `date` - æ”¯å‡ºæ—¥æœŸï¼ˆéç©ºï¼‰
- `type` - æ”¯å‡ºç±»å‹ï¼ˆcompany/otherï¼Œéç©ºï¼‰
- `amount` - æ”¯å‡ºé‡‘é¢ï¼ˆéç©ºï¼‰
- `note` - å¤‡æ³¨è¯´æ˜ï¼ˆå¯ä¸ºNULLï¼‰
- `created_at` - åˆ›å»ºæ—¶é—´

---

## ğŸ‘¥ ç”¨æˆ·æƒé™è¡¨

### 7. **authorized_users** - æˆæƒç”¨æˆ·è¡¨
**ç”¨é€”**ï¼šå­˜å‚¨æˆæƒå‘˜å·¥ç”¨æˆ·IDï¼ˆå…è®¸ä½¿ç”¨åŸºç¡€åŠŸèƒ½ï¼‰

**å­—æ®µ**ï¼š
- `user_id` - ç”¨æˆ·IDï¼ˆä¸»é”®ï¼‰
- `added_at` - æ·»åŠ æ—¶é—´

---

### 8. **user_group_mapping** - ç”¨æˆ·å½’å±IDæ˜ å°„è¡¨
**ç”¨é€”**ï¼šé™åˆ¶ç”¨æˆ·åªèƒ½æŸ¥çœ‹ç‰¹å®šå½’å±IDçš„æŠ¥è¡¨

**å­—æ®µ**ï¼š
- `user_id` - ç”¨æˆ·IDï¼ˆä¸»é”®ï¼‰
- `group_id` - å½’å±IDï¼ˆéç©ºï¼‰
- `created_at` - åˆ›å»ºæ—¶é—´
- `updated_at` - æ›´æ–°æ—¶é—´

---

## ğŸ’³ æ”¯ä»˜è´¦å·è¡¨

### 9. **payment_accounts** - æ”¯ä»˜è´¦å·è¡¨
**ç”¨é€”**ï¼šå­˜å‚¨GCASHå’ŒPayMayaæ”¯ä»˜è´¦å·ä¿¡æ¯

**å­—æ®µ**ï¼š
- `id` - ä¸»é”®ï¼ˆè‡ªå¢ï¼‰
- `account_type` - è´¦å·ç±»å‹ï¼ˆgcash/paymayaï¼Œéç©ºï¼‰
- `account_number` - è´¦å·å·ç ï¼ˆéç©ºï¼‰
- `account_name` - è´¦å·åç§°ï¼ˆå¯ä¸ºNULLï¼‰
- `balance` - ä½™é¢ï¼ˆé»˜è®¤0ï¼‰
- `updated_at` - æ›´æ–°æ—¶é—´

**è¯´æ˜**ï¼šæ¯ä¸ªè´¦å·ç±»å‹ï¼ˆgcash/paymayaï¼‰å¯ä»¥æœ‰å¤šä¸ªè´¦å·è®°å½•

---

## ğŸ“¢ æ’­æŠ¥è¡¨

### 10. **scheduled_broadcasts** - å®šæ—¶æ’­æŠ¥è¡¨
**ç”¨é€”**ï¼šå­˜å‚¨å®šæ—¶æ’­æŠ¥ä»»åŠ¡é…ç½®

**å­—æ®µ**ï¼š
- `id` - ä¸»é”®ï¼ˆè‡ªå¢ï¼‰
- `slot` - æ’­æŠ¥æ—¶æ®µï¼ˆ1-3ï¼Œéç©ºï¼‰
- `time` - æ’­æŠ¥æ—¶é—´ï¼ˆéç©ºï¼‰
- `chat_id` - ç¾¤ç»„IDï¼ˆå¯ä¸ºNULLï¼‰
- `chat_title` - ç¾¤ç»„æ ‡é¢˜ï¼ˆå¯ä¸ºNULLï¼‰
- `message` - æ’­æŠ¥æ¶ˆæ¯ï¼ˆéç©ºï¼‰
- `is_active` - æ˜¯å¦æ¿€æ´»ï¼ˆé»˜è®¤1ï¼‰
- `created_at` - åˆ›å»ºæ—¶é—´
- `updated_at` - æ›´æ–°æ—¶é—´

**çº¦æŸ**ï¼š`UNIQUE(slot)` - æ¯ä¸ªæ—¶æ®µåªèƒ½æœ‰ä¸€æ¡è®°å½•

---

## ğŸ”„ æ“ä½œå†å²è¡¨

### 11. **operation_history** - æ“ä½œå†å²è¡¨
**ç”¨é€”**ï¼šè®°å½•ç”¨æˆ·æ“ä½œå†å²ï¼ˆç”¨äºæ’¤é”€åŠŸèƒ½ï¼‰

**å­—æ®µ**ï¼š
- `id` - ä¸»é”®ï¼ˆè‡ªå¢ï¼‰
- `user_id` - ç”¨æˆ·IDï¼ˆéç©ºï¼‰
- `operation_type` - æ“ä½œç±»å‹ï¼ˆéç©ºï¼‰
- `operation_data` - æ“ä½œæ•°æ®ï¼ˆJSONæ ¼å¼ï¼Œéç©ºï¼‰
- `created_at` - åˆ›å»ºæ—¶é—´
- `is_undone` - æ˜¯å¦å·²æ’¤é”€ï¼ˆé»˜è®¤0ï¼‰
- `chat_id` - èŠå¤©ç¯å¢ƒIDï¼ˆéç©ºï¼Œé»˜è®¤0ï¼‰

**ç´¢å¼•**ï¼š
- `idx_operation_user_time` - ç”¨æˆ·+æ—¶é—´ç´¢å¼•
- `idx_operation_undone` - æ’¤é”€çŠ¶æ€+æ—¶é—´ç´¢å¼•
- `idx_operation_chat_user` - èŠå¤©+ç”¨æˆ·+æ—¶é—´ç´¢å¼•

---

## ğŸ“Š æ•°æ®å…³ç³»è¯´æ˜

### ä¸‰å±‚ç»Ÿè®¡æ¶æ„

1. **financial_data** - å…¨å±€ç´¯è®¡ç»Ÿè®¡ï¼ˆå•æ¡è®°å½•ï¼‰
2. **grouped_data** - åˆ†ç»„ç´¯è®¡ç»Ÿè®¡ï¼ˆæ¯ä¸ªå½’å±IDä¸€æ¡è®°å½•ï¼‰
3. **daily_data** - æ—¥ç»“æµé‡ç»Ÿè®¡ï¼ˆæŒ‰æ—¥æœŸ+å½’å±IDå­˜å‚¨ï¼‰

### æ˜ç»†è®°å½•

- **income_records** - æ”¶å…¥æ˜ç»†ï¼ˆå…³è”åˆ°è®¢å•ã€å½’å±IDã€å®¢æˆ·ç±»å‹ï¼‰
- **expense_records** - æ”¯å‡ºæ˜ç»†ï¼ˆå…³è”åˆ°æ—¥æœŸå’Œç±»å‹ï¼‰

### æƒé™æ§åˆ¶

- **authorized_users** - æˆæƒå‘˜å·¥åˆ—è¡¨
- **user_group_mapping** - å—é™ç”¨æˆ·åŠå…¶å¯æŸ¥çœ‹çš„å½’å±ID

---

## ğŸ” å¿«é€ŸæŸ¥è¯¢å‘½ä»¤

### æŸ¥çœ‹æ‰€æœ‰è¡¨
```sql
SELECT name FROM sqlite_master WHERE type='table' ORDER BY name;
```

### æŸ¥çœ‹è¡¨ç»“æ„
```sql
PRAGMA table_info(è¡¨å);
```

### æŸ¥çœ‹è¡¨æ•°æ®é‡
```sql
SELECT 
    name AS è¡¨å,
    (SELECT COUNT(*) FROM sqlite_master WHERE type='table' AND name=m.name) AS è®°å½•æ•°
FROM sqlite_master m
WHERE type='table' AND name NOT LIKE 'sqlite_%'
ORDER BY name;
```

---

**æœ€åæ›´æ–°**ï¼š2025-12-02
**æ•°æ®åº“æ–‡ä»¶**ï¼š`loan_bot.db`
**åˆå§‹åŒ–è„šæœ¬**ï¼š`init_db.py`

