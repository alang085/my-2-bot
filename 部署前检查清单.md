# 部署前检查清单

## ✅ 代码检查

### 1. 文件完整性
- [x] `main.py` - 主程序文件
- [x] `init_db.py` - 数据库初始化
- [x] `requirements.txt` - Python依赖
- [x] `Procfile` - 启动命令
- [x] `Dockerfile` - Docker配置
- [x] `zeabur.json` - Zeabur配置

### 2. 敏感文件检查
- [x] `config.py` 在 `.gitignore` 中
- [x] `user_config.py` 在 `.gitignore` 中
- [x] `*.db` 在 `.gitignore` 中
- [x] `temp/` 在 `.gitignore` 中

### 3. 代码质量
- [x] 所有文件通过语法检查
- [x] 所有模块导入成功
- [x] 无语法错误
- [x] 无导入错误

## ✅ 功能检查

### 1. Excel报表功能
- [x] 增量订单报表功能正常
- [x] 每日数据变更报表功能正常
- [x] 订单总表功能正常
- [x] 权限设置正确（员工可查看，管理员可合并）

### 2. 增量报表系统
- [x] 基准日期管理功能正常
- [x] 增量数据查询功能正常
- [x] 合并功能正常
- [x] 定时任务配置正确

### 3. 其他功能
- [x] 群组自动信息功能正常
- [x] 订单管理功能正常
- [x] 报表功能正常

## ✅ 测试检查

### 1. 本地测试
- [x] 运行 `test_all_excel_reports.py` 通过
- [x] Excel文件生成正常
- [x] 所有功能测试通过

### 2. 功能验证
- [x] Excel报表格式正确
- [x] 权限设置正确
- [x] 数据库操作正常

## ⚠️ 部署前必须确认

### 1. 基准日期设置
- [ ] **重要**：确认基准日期是否正确设置
- [ ] 基准日期应该是最后一次完整录入数据的日期
- [ ] 如果未设置，部署后需要手动设置

### 2. 环境变量准备
- [ ] `BOT_TOKEN` - 机器人Token
- [ ] `ADMIN_USER_IDS` - 管理员用户ID（多个用逗号分隔）
- [ ] `DATA_DIR=/data` - 数据目录（用于持久化）

### 3. Zeabur配置
- [ ] Volume已配置（Mount Path: `/data`）
- [ ] 环境变量已设置
- [ ] Git仓库已连接

## 📋 部署步骤

### 1. 运行部署脚本

**Windows:**
```bash
deploy_to_zeabur.bat
```

**Linux/Mac:**
```bash
chmod +x deploy_to_zeabur.sh
./deploy_to_zeabur.sh
```

### 2. 手动部署（如果脚本不可用）

```bash
# 1. 检查状态
git status

# 2. 添加文件
git add .

# 3. 提交更改
git commit -m "Update: Excel报表权限扩展到员工，优化代码"

# 4. 推送到远程
git push origin main
```

### 3. 在Zeabur验证

1. 访问 Zeabur Dashboard
2. 查看部署状态
3. 检查日志输出
4. 验证功能正常

## 🔍 部署后验证

### 1. 基本功能
- [ ] 机器人可以正常启动
- [ ] 可以接收消息
- [ ] 命令响应正常

### 2. Excel报表功能
- [ ] `/preview_incremental` - 预览增量报表
- [ ] `/daily_changes` - 查看每日数据变更
- [ ] `/ordertable` - 导出订单总表

### 3. 权限验证
- [ ] 员工可以查看Excel报表
- [ ] 管理员可以合并增量报表
- [ ] 权限设置正确

### 4. 定时任务
- [ ] 增量报表定时任务正常（11:05）
- [ ] 日切报表定时任务正常（23:00）
- [ ] 其他定时任务正常

## ⚠️ 重要提醒

1. **数据库备份**
   - 部署前备份数据库（如果已有数据）
   - 保留备份文件

2. **基准日期**
   - 部署后检查基准日期设置
   - 如果未设置，需要手动设置

3. **环境变量**
   - 确保所有环境变量已正确设置
   - 特别是 `BOT_TOKEN` 和 `ADMIN_USER_IDS`

4. **Volume配置**
   - 确保Volume挂载到 `/data`
   - 确保 `DATA_DIR=/data` 环境变量已设置

## 📚 相关文档

- `DEPLOY.md` - 详细部署指南
- `生产环境部署检查清单.md` - 生产环境检查
- `第一次整体报表录入指南.md` - 第一次录入指南
- `部署准备完成报告.md` - 完成状态报告

