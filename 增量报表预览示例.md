# 增量报表预览示例

## 命令使用

### 1. 预览增量报表
```
/preview_incremental
```
显示增量报表的摘要信息，包括：
- 基准日期和当前日期
- 订单统计（新增订单数、金额、新/老客户统计）
- 收入统计（利息、归还本金、完成订单等）
- 开销统计（公司开销、其他开销）
- 订单列表（前10个订单的详细信息）

### 2. 合并增量报表到全局数据
```
/merge_incremental
```
将增量报表的数据合并到全局统计数据，并更新：
- 全局财务数据（financial_data）
- 分组数据（grouped_data）
- 日结数据（daily_data）

## 预览示例

### 预览输出格式

```
📊 增量报表预览
════════════════════════════════════════
基准日期: 2024-01-14
当前日期: 2024-01-20
════════════════════════════════════════

📦 订单统计
新增订单数: 5
新增订单金额: 50,000.00
新客户数: 3
新客户金额: 30,000.00
老客户数: 2
老客户金额: 20,000.00

💰 收入统计
利息收入: 2,500.00
归还本金: 5,000.00
完成订单数: 2
完成订单金额: 20,000.00
违约完成订单数: 0
违约完成金额: 0.00

💸 开销统计
公司开销: 500.00
其他开销: 200.00
总开销: 700.00

📋 订单列表（显示前10个，共5个）
────────────────────────────────────────
1. ORD001 | A | 10,000.00 | 利息:500.00 | 本金:0.00 | normal
2. ORD002 | B | 20,000.00 | 利息:1,000.00 | 本金:2,000.00 | normal
3. ORD003 | A | 15,000.00 | 利息:750.00 | 本金:0.00 | end
4. ORD004 | A | 5,000.00 | 利息:250.00 | 本金:3,000.00 | normal
5. ORD005 | B | 0.00 | 利息:0.00 | 本金:0.00 | end
```

## Excel报表格式

### 主工作表：增量订单报表

| 日期 | 订单号 | 会员 | 订单金额 | 利息总数 | 归还本金 | 订单状态 | 备注 |
|------|--------|------|----------|----------|----------|----------|------|
| 2024-01-15 | ORD001 | A | 10,000.00 | 500.00 | 0.00 | 正常 | 新订单 |
| 2024-01-16 | ORD002 | B | 20,000.00 | 1,000.00 | 2,000.00 | 正常 | 新订单→归还本金 |
| 2024-01-17 | ORD003 | A | 15,000.00 | 750.00 | 0.00 | 完成 | 新订单→订单完成 |
| 汇总 | - | - | 45,000.00 | 2,250.00 | 2,000.00 | 3个订单 | - |

### 利息明细（可展开）

点击"利息总数"列左侧的展开按钮，可以查看每期利息明细：

**ORD001订单的利息明细：**
```
利息总数: 500.00
  └─ 2024-01-15: 500.00
```

**ORD002订单的利息明细：**
```
利息总数: 1,000.00
  └─ 2024-01-16: 500.00
  └─ 2024-01-17: 500.00
```

### 开销明细工作表

| 日期 | 类型 | 金额 | 备注 |
|------|------|------|------|
| 2024-01-15 | 公司开销 | 500.00 | 办公用品 |
| 2024-01-18 | 其他开销 | 200.00 | 差旅费 |
| 汇总 | - | 700.00 | - |

## 合并功能说明

### 合并操作

执行 `/merge_incremental` 命令后，系统会：

1. **计算增量统计**
   - 统计新增订单数、金额
   - 统计新/老客户数据
   - 统计利息收入
   - 统计完成订单
   - 统计开销

2. **更新全局数据**
   - 更新 `financial_data` 表的全局统计数据
   - 更新 `grouped_data` 表的分组统计数据
   - 更新 `daily_data` 表的日结数据

3. **返回合并结果**
   - 显示合并成功的统计信息
   - 包括订单数、利息、开销等关键数据

### 合并输出示例

```
✅ 增量报表已合并到全局数据

📦 订单: 5个, 50,000.00
💰 利息: 2,500.00
💸 开销: 700.00
```

## 注意事项

1. **数据一致性**：合并操作会更新全局统计数据，确保数据一致性
2. **重复合并**：如果数据已经更新过，合并操作不会重复累加（因为业务操作时已经更新）
3. **权限要求**：预览和合并功能仅限管理员使用
4. **基准日期**：第一次执行时会自动创建基准日期

## 使用流程

1. **查看预览**：使用 `/preview_incremental` 查看增量数据摘要
2. **确认数据**：检查预览中的统计数据是否正确
3. **合并数据**：使用 `/merge_incremental` 将增量数据合并到全局统计
4. **验证结果**：使用 `/report` 查看更新后的全局报表

