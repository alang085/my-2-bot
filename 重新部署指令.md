# é‡æ–°éƒ¨ç½²æŒ‡ä»¤

## ğŸ“‹ éƒ¨ç½²æ­¥éª¤

### 1. è¿æ¥åˆ°ç”Ÿäº§æœåŠ¡å™¨

```bash
ssh user@production-server
# æˆ–ä½¿ç”¨ Docker
docker exec -it <container_name> bash
```

### 2. è¿›å…¥é¡¹ç›®ç›®å½•

```bash
cd /app
# æˆ–ä½ çš„é¡¹ç›®å®é™…è·¯å¾„
```

### 3. æ‹‰å–æœ€æ–°ä»£ç 

```bash
git pull origin main
```

### 4. æ£€æŸ¥ä»£ç æ˜¯å¦æ›´æ–°

```bash
git log --oneline -5
```

åº”è¯¥çœ‹åˆ°æœ€æ–°çš„æäº¤ï¼š
- `è°ƒæ•´æ”¶å…¥æ˜ç»†æ˜¾ç¤ºæ ¼å¼`
- `ä¸ºå•ç±»å‹åˆ†é¡µæ˜¾ç¤ºæ·»åŠ è¡¨å¤´`
- `ä¿®å¤æ”¶å…¥æ˜ç»†åˆ†é¡µè·³è½¬é—®é¢˜`

### 5. é‡å¯æœºå™¨äºº

**æ–¹å¼1ï¼šå¦‚æœä½¿ç”¨ systemd ç®¡ç†**

```bash
sudo systemctl restart loan-bot
# æˆ–
sudo systemctl restart your-service-name
```

**æ–¹å¼2ï¼šå¦‚æœä½¿ç”¨ Docker**

```bash
docker restart <container_name>
```

**æ–¹å¼3ï¼šå¦‚æœä½¿ç”¨ supervisor**

```bash
sudo supervisorctl restart loan-bot
```

**æ–¹å¼4ï¼šå¦‚æœç›´æ¥è¿è¡Œ Python è„šæœ¬**

```bash
# åœæ­¢å½“å‰è¿›ç¨‹
pkill -f main.py
# æˆ–
pkill -f bot.py

# é‡æ–°å¯åŠ¨ï¼ˆæ ¹æ®ä½ çš„å¯åŠ¨æ–¹å¼ï¼‰
nohup python main.py > bot.log 2>&1 &
# æˆ–
python main.py &
```

**æ–¹å¼5ï¼šå¦‚æœä½¿ç”¨ PM2**

```bash
pm2 restart loan-bot
# æˆ–
pm2 restart all
```

### 6. éªŒè¯éƒ¨ç½²

```bash
# æŸ¥çœ‹æ—¥å¿—ç¡®è®¤å¯åŠ¨æˆåŠŸ
tail -f bot.log
# æˆ–
docker logs -f <container_name>
# æˆ–
pm2 logs loan-bot
```

### 7. æµ‹è¯•åŠŸèƒ½

åœ¨ Telegram ä¸­æµ‹è¯•ï¼š
1. è¿›å…¥æŠ¥è¡¨
2. ç‚¹å‡»"æ”¶å…¥æ˜ç»†"
3. æ£€æŸ¥æ ¼å¼æ˜¯å¦æ­£ç¡®æ˜¾ç¤ºï¼šæ—¶é—´ | è®¢å•å· | é‡‘é¢
4. æ£€æŸ¥æ’åºæ˜¯å¦æ­£ç¡®ï¼ˆè®¢å•å®Œæˆã€è¿çº¦å®Œæˆã€æœ¬é‡‘å‡å°‘ã€åˆ©æ¯æ”¶å…¥ï¼‰
5. æ£€æŸ¥æ•°æ®æ˜¯å¦æŒ‰å½•å…¥æ—¶é—´æ­£åºæ’åˆ—

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¤‡ä»½æ•°æ®**ï¼ˆå¦‚æœéœ€è¦ï¼‰ï¼š
   ```bash
   cp /data/loan_bot.db /data/loan_bot.db.backup.$(date +%Y%m%d_%H%M%S)
   ```

2. **æ£€æŸ¥ç¯å¢ƒå˜é‡**ï¼š
   ç¡®ä¿ `DATA_DIR` ç­‰ç¯å¢ƒå˜é‡æ­£ç¡®è®¾ç½®

3. **æ£€æŸ¥ä¾èµ–**ï¼š
   å¦‚æœæœ‰æ–°çš„ä¾èµ–ï¼Œéœ€è¦å®‰è£…ï¼š
   ```bash
   pip install -r requirements.txt
   ```

## ğŸš€ ä¸€é”®éƒ¨ç½²è„šæœ¬

å¦‚æœç»å¸¸éœ€è¦éƒ¨ç½²ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªéƒ¨ç½²è„šæœ¬ï¼š

```bash
#!/bin/bash
# deploy.sh

cd /app
echo "æ‹‰å–æœ€æ–°ä»£ç ..."
git pull origin main

echo "é‡å¯æœåŠ¡..."
# æ ¹æ®ä½ çš„éƒ¨ç½²æ–¹å¼é€‰æ‹©
# systemctl restart loan-bot
# docker restart <container_name>
# pm2 restart loan-bot

echo "éƒ¨ç½²å®Œæˆï¼"
```

ä¿å­˜ä¸º `deploy.sh`ï¼Œç„¶åï¼š
```bash
chmod +x deploy.sh
./deploy.sh
```

