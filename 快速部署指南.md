# 🚀 快速部署指南

## 📋 部署前准备

### 方式一：CLI 快速部署（推荐 ⚡）

**优点：**
- ✅ 最快最直接
- ✅ 无需 Git 仓库
- ✅ 一键部署

**步骤：**

1. **安装 Node.js**（如果还没有）
   - 访问：https://nodejs.org/
   - 下载并安装 **LTS 版本**
   - 安装完成后重启终端

2. **运行部署脚本**
   ```bash
   # 在项目根目录执行
   deploy_zeabur_cli.bat
   ```

   或直接使用命令：
   ```bash
   # 首次使用需要登录
   npx zeabur@latest auth login
   
   # 部署
   npx zeabur@latest deploy
   ```

3. **脚本会自动：**
   - ✅ 检查 Node.js 是否安装
   - ✅ 检查必要文件是否存在
   - ✅ 检查登录状态（未登录会自动打开浏览器登录）
   - ✅ 执行部署命令

---

### 方式二：Git 自动部署

**优点：**
- ✅ 每次 `git push` 自动触发部署
- ✅ 适合持续集成/持续部署（CI/CD）

**步骤：**

1. **准备 Git 仓库**
   ```bash
   # 如果还没有 Git 仓库
   git init
   git add .
   git commit -m "Initial commit"
   
   # 推送到 GitHub/GitLab
   git remote add origin <你的仓库地址>
   git push -u origin main
   ```

2. **在 Zeabur 部署**
   - 访问 [Zeabur Dashboard](https://dash.zeabur.com)
   - 点击 **"New Project"**
   - 选择 **"Import from Git"**
   - 连接你的 Git 仓库
   - 选择仓库和分支

3. **或使用部署脚本**
   ```bash
   deploy_to_zeabur.bat
   ```

---

## ⚙️ 部署后配置（重要！）

部署完成后，必须在 Zeabur Dashboard 进行以下配置：

### 1. 配置环境变量

在项目设置 → **Environment Variables** 中添加：

```
BOT_TOKEN=你的机器人Token
ADMIN_USER_IDS=你的用户ID
DATA_DIR=/data
```

**获取方式：**
- **BOT_TOKEN**: 
  - 在 Telegram 搜索 `@BotFather`
  - 发送 `/token`
  - 选择你的机器人
  - 复制 Token

- **ADMIN_USER_IDS**: 
  - 在 Telegram 搜索 `@userinfobot`
  - 发送消息
  - 获取你的用户ID（数字）
  - 多个管理员用逗号分隔，无空格：`123456789,987654321`

### 2. 配置持久化存储（必须！）

在项目设置 → **Volumes** 中添加：

- **Mount Path**: `/data`
- **Size**: 1GB（可根据需要调整）

**重要：** 数据库文件会存储在 Volume 中，容器重启不会丢失数据。

---

## ✅ 验证部署

1. **查看日志**
   - 在 Zeabur Dashboard → **Logs** 标签页查看运行日志
   - 确认没有错误信息

2. **测试机器人**
   - 在 Telegram 中向机器人发送 `/start`（私聊）
   - 检查是否收到欢迎消息

3. **测试功能**
   - 测试创建订单功能
   - 测试查询报表功能

---

## 🔄 更新部署

### CLI 部署更新

直接再次运行部署脚本：
```bash
deploy_zeabur_cli.bat
```

或使用命令：
```bash
npx zeabur@latest deploy
```

### Git 部署更新

每次推送代码到 Git 仓库，Zeabur 会自动检测并重新部署：
```bash
git add .
git commit -m "Update code"
git push
```

---

## 🔧 故障排查

### 问题：Node.js 未安装

**解决方案：**
1. 访问 https://nodejs.org/
2. 下载并安装 LTS 版本
3. 安装后重启终端
4. 重新运行部署脚本

### 问题：登录失败

**解决方案：**
- 检查网络连接
- 确保浏览器可以正常打开
- 手动运行：`npx zeabur@latest auth login`

### 问题：部署失败

**检查项：**
1. 网络连接是否正常
2. Zeabur 账户是否有权限
3. 必要文件是否存在：
   - `main.py`
   - `requirements.txt`
   - `Dockerfile`
   - `zeabur.json`
4. 查看错误信息，根据提示修复

### 问题：机器人无法启动

**检查项：**
1. 环境变量是否正确设置（BOT_TOKEN, ADMIN_USER_IDS）
2. Volume 是否正确挂载（Mount Path: `/data`）
3. 查看运行日志中的错误信息

---

## 📝 快速命令参考

```bash
# 检查 Node.js 版本
node --version

# 检查 Zeabur 登录状态
npx zeabur@latest auth whoami

# 登录 Zeabur
npx zeabur@latest auth login

# 部署到 Zeabur
npx zeabur@latest deploy

# 查看部署状态
npx zeabur@latest status
```

---

## 🎯 推荐流程

1. **首次部署**
   - 安装 Node.js
   - 运行 `deploy_zeabur_cli.bat`
   - 在 Zeabur Dashboard 配置环境变量和 Volume
   - 验证部署

2. **后续更新**
   - 直接运行 `deploy_zeabur_cli.bat` 或
   - 使用 Git 推送（如果使用 Git 部署）

---

## 📚 相关文档

- [完整部署指南](DEPLOY.md) - 详细的部署说明
- [Zeabur CLI 部署指南](ZEABUR_CLI_DEPLOY.md) - CLI 部署详细说明
- [配置和数据库说明](CONFIG_AND_DATABASE.md) - 配置相关说明




