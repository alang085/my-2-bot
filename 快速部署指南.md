# 快速部署到 Zeabur 指南

## 🚀 一键部署

### Windows 用户

1. **运行部署脚本**
   ```bash
   deploy_to_zeabur.bat
   ```

2. **按提示操作**
   - 检查文件
   - 输入提交信息
   - 确认推送

### Linux/Mac 用户

1. **添加执行权限**
   ```bash
   chmod +x deploy_to_zeabur.sh
   ```

2. **运行部署脚本**
   ```bash
   ./deploy_to_zeabur.sh
   ```

3. **按提示操作**
   - 检查文件
   - 输入提交信息
   - 确认推送

## 📋 手动部署步骤

如果脚本不可用，可以手动执行：

### 1. 检查当前状态
```bash
git status
```

### 2. 添加所有更改
```bash
git add .
```

### 3. 提交更改
```bash
git commit -m "Update: Excel报表权限扩展到员工，优化代码，准备生产环境部署"
```

### 4. 推送到远程仓库
```bash
git push origin main
```

## ✅ 部署前检查

### 快速检查清单

运行以下命令检查：

```bash
# 检查敏感文件是否被跟踪
git ls-files config.py user_config.py loan_bot.db

# 如果输出为空，说明安全 ✅
# 如果有输出，需要从Git中移除这些文件
```

### 必要文件检查

确保以下文件存在：
- ✅ `main.py`
- ✅ `init_db.py`
- ✅ `requirements.txt`
- ✅ `Procfile`
- ✅ `Dockerfile`
- ✅ `zeabur.json`

## 🔍 部署后验证

### 1. 在 Zeabur Dashboard 检查

1. 访问 [Zeabur Dashboard](https://dash.zeabur.com)
2. 查看部署状态
3. 检查日志输出
4. 确认部署成功

### 2. 在 Telegram 测试

**基本功能：**
```
/start - 查看帮助信息
```

**Excel报表功能（员工权限）：**
```
/preview_incremental - 预览增量报表
/daily_changes - 查看每日数据变更
/ordertable - 导出订单总表
```

**合并功能（管理员权限）：**
```
/merge_incremental - 合并增量报表
```

### 3. 检查定时任务

- 增量报表：每天11:05自动发送
- 日切报表：每天23:00自动发送

## ⚠️ 重要配置

### 环境变量（在 Zeabur 中设置）

```
BOT_TOKEN=你的机器人Token
ADMIN_USER_IDS=你的用户ID（多个用逗号分隔，无空格）
DATA_DIR=/data
```

### Volume 配置

在 Zeabur 项目设置中：
- **Mount Path**: `/data`
- **Size**: 1GB（可根据需要调整）

## 🔄 更新流程

每次更新代码：

1. **本地修改代码**
2. **运行部署脚本** 或 **手动提交推送**
3. **Zeabur 自动检测并重新部署**
4. **在 Dashboard 查看部署状态**

## 📚 相关文档

- `部署前检查清单.md` - 详细检查清单
- `DEPLOY.md` - 完整部署指南
- `生产环境部署检查清单.md` - 生产环境检查
- `第一次整体报表录入指南.md` - 第一次录入指南

## 🆘 常见问题

### Q: 部署失败怎么办？

**A:** 检查：
1. 查看 Zeabur 日志中的错误信息
2. 确认 `requirements.txt` 正确
3. 确认环境变量已设置
4. 确认 Volume 已配置

### Q: 机器人无法启动？

**A:** 检查：
1. `BOT_TOKEN` 是否正确
2. `ADMIN_USER_IDS` 格式是否正确（数字，逗号分隔，无空格）
3. 查看日志中的错误信息

### Q: 数据库丢失？

**A:** 检查：
1. Volume 是否已配置（Mount Path: `/data`）
2. `DATA_DIR=/data` 环境变量是否已设置
3. 数据库文件是否在 Volume 中

## ✅ 部署完成检查

部署成功后，确认：

- [ ] 机器人可以正常启动
- [ ] 可以接收和响应消息
- [ ] Excel报表功能正常
- [ ] 权限设置正确
- [ ] 定时任务正常
- [ ] 数据库持久化正常

