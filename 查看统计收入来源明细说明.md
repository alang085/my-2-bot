# 查看统计收入来源明细说明

## 📊 统计表 vs 收入明细表

### `daily_data` 表（统计表）
- **只存储聚合数据**：总计金额、订单数量等
- **不包含明细信息**：没有时间、订单号、单笔金额等详细信息
- **用途**：快速查询某一天的统计汇总

**示例数据**：
```
日期: 2025-12-02
归属ID: S01
利息收入: 1,234.56 元（总计）
完成订单: 5,000.00 元（总计）
```

### `income_records` 表（收入明细表）
- **存储详细记录**：每笔收入的时间、订单号、金额等
- **包含完整信息**：`created_at`（时间）、`order_id`（订单号）、`amount`（金额）等
- **用途**：查看每笔收入的详细信息

**示例数据**：
```
时间: 14:30:25 | 订单号: 2512020301 | 金额: 300.00
时间: 15:20:10 | 订单号: 2512020302 | 金额: 500.00
时间: 16:45:33 | 订单号: 2512020303 | 金额: 434.56
```

## 🔍 如何查看统计收入的来源明细

### 方法一：通过收入明细查询（推荐）✅

#### 步骤 1：打开收入明细
- 在报表界面，点击 **「💰 收入明细」** 按钮
- 或发送命令：`/收入明细`

#### 步骤 2：选择查询方式
- **今日收入**：查看今天的所有收入明细
- **本月收入**：查看本月的所有收入明细
- **日期查询**：输入日期查看指定日期的收入明细
- **分类查询**：按收入类型（利息收入、订单完成等）查看

#### 步骤 3：高级查询（精确筛选）
1. 点击 **「🔍 分类查询」**
2. 点击 **「🔍 高级查询」**
3. 选择日期（例如：2025-12-02）
4. 选择收入类型（例如：利息收入）
5. 选择归属ID（例如：S01）
6. 查看结果，会显示：
   - 时间 | 订单号 | 金额（对齐显示）
   - 所有符合条件的详细记录

### 方法二：通过 `/check_mismatch` 命令

在 Telegram 私聊中发送：

```
/check_mismatch 2025-12-02
```

输出会包含：
- 统计数据汇总
- 收入明细汇总
- 差异分析
- **所有收入明细记录列表**（包含时间、订单号、金额）

### 方法三：查看完整报表

在报表界面：
1. 点击 **「💰 收入明细」**
2. 选择 **「📅 日期查询」**
3. 输入日期（例如：`2025-12-02`）
4. 查看完整明细列表

报表格式：
```
时间      订单号                 金额
────────────────────────────────────────
14:30:25  2512020301         300.00
15:20:10  2512020302         500.00
16:45:33  2512020303         434.56
```

## 📋 查看示例

### 示例：查看 S01 归属ID 在 2025-12-02 的利息收入明细

**步骤**：
1. 打开报表：`/report`
2. 点击 **「💰 收入明细」**
3. 点击 **「🔍 分类查询」**
4. 点击 **「🔍 高级查询」**
5. 选择日期：`2025-12-02`
6. 选择类型：`利息收入`
7. 选择归属ID：`S01`
8. 查看结果

**输出示例**：
```
💰 收入明细查询 (2025-12-02)
类型: 利息收入 | 归属ID: S01
═══════════════════════════════
【利息收入】总计: 1,234.56 (3笔)
────────────────────────────────────────
时间      订单号                 金额
────────────────────────────────────────
1. 14:30:25  2512020301         300.00
2. 15:20:10  2512020302         500.00
3. 16:45:33  2512020303         434.56
```

## ⚠️ 重要说明

### 统计表不包含明细的原因

1. **性能考虑**：
   - 统计表只需要汇总数据，不需要存储每笔记录
   - 查询统计时不需要扫描大量明细记录

2. **存储优化**：
   - 明细存储在 `income_records` 表
   - 统计表只存储汇总结果
   - 减少数据库存储空间

3. **设计原则**：
   - 统计表：快速汇总查询
   - 明细表：详细记录查询
   - 两者配合使用

### 如何确认统计收入的来源

**验证方法**：
1. 查看统计表的总计金额（例如：1,234.56 元）
2. 查询对应日期、类型、归属ID的收入明细
3. 汇总明细金额，应该等于统计表的金额

**示例验证**：
```
统计表：利息收入 1,234.56 元

明细记录：
  300.00 + 500.00 + 434.56 = 1,234.56 ✅ 一致
```

## 🔧 如果发现不一致

如果统计表的金额和明细汇总不一致：

1. **使用诊断命令**：
   ```
   /check_mismatch 2025-12-02
   ```
   查看详细的差异分析

2. **修复统计数据**：
   ```
   /fix_statistics
   ```
   重新计算并更新统计表

## 📞 需要帮助？

- 查看收入明细：使用 `/收入明细` 或报表界面的「💰 收入明细」按钮
- 精确筛选：使用「高级查询」功能
- 诊断问题：使用 `/check_mismatch` 命令

---

**最后更新**：2025-12-02
**版本**：1.0

