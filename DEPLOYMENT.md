# 生产环境部署指南

## 📋 部署前检查清单

### 1. 代码清理
- [x] 所有群组消息已改为英文
- [x] 临时文件已清理
- [x] 测试数据库已排除
- [x] 未使用的代码已删除

### 2. 环境配置
- [ ] 设置 `BOT_TOKEN` 环境变量
- [ ] 设置 `ADMIN_USER_IDS` 环境变量（逗号分隔）
- [ ] 设置 `DATA_DIR` 环境变量（可选，用于数据目录）

### 3. 数据库
- [ ] 数据库文件路径配置正确
- [ ] 数据库备份机制已设置
- [ ] 数据库初始化脚本已运行（如需要）

### 4. 依赖
- [ ] `requirements.txt` 已更新
- [ ] 所有依赖已安装
- [ ] Python 版本符合要求（3.9+）

## 🚀 部署步骤

### Zeabur 部署

1. **环境变量配置**
   ```
   BOT_TOKEN=your_bot_token
   ADMIN_USER_IDS=123456789,987654321
   DATA_DIR=/data  # 可选
   ```

2. **部署命令**
   ```bash
   # 自动部署（通过 Git）
   git push origin main
   ```

3. **验证部署**
   - 检查服务状态
   - 测试机器人响应
   - 检查日志输出

### 本地/服务器部署

1. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

2. **配置环境变量**
   ```bash
   export BOT_TOKEN=your_bot_token
   export ADMIN_USER_IDS=123456789,987654321
   ```

3. **初始化数据库**
   ```bash
   python init_db.py
   ```

4. **启动服务**
   ```bash
   python main.py
   ```

5. **使用 systemd/supervisor 管理服务**
   ```bash
   # 参考 deployment/ 目录中的配置文件
   sudo systemctl enable loan-bot
   sudo systemctl start loan-bot
   ```

## 🔒 安全注意事项

1. **敏感信息**
   - 不要提交 `user_config.py` 到版本控制
   - 不要提交数据库文件
   - 使用环境变量存储敏感配置

2. **权限控制**
   - 确保只有授权用户可以访问
   - 定期检查管理员列表
   - 监控异常操作

3. **数据备份**
   - 定期备份数据库
   - 保留操作历史记录
   - 设置自动备份机制

## 📊 监控和维护

1. **日志监控**
   - 检查错误日志
   - 监控性能指标
   - 跟踪异常操作

2. **定期维护**
   - 清理临时文件
   - 优化数据库
   - 更新依赖包

3. **故障处理**
   - 查看日志文件
   - 检查数据库状态
   - 验证环境变量配置

## ⚠️ 常见问题

### 问题1: 机器人无响应
- 检查 `BOT_TOKEN` 是否正确
- 检查网络连接
- 查看日志文件

### 问题2: 数据库错误
- 检查数据库文件权限
- 验证数据库路径
- 运行数据库修复工具

### 问题3: 权限错误
- 检查 `ADMIN_USER_IDS` 配置
- 验证用户ID格式
- 检查授权用户列表

## 📝 更新日志

查看 `CHANGELOG.md` 了解版本更新信息。

