# 机器人使用指南

## 🚀 启动机器人

### 启动命令
```bash
python3 main.py
```

### 后台运行（可选）
```bash
# 使用 nohup
nohup python3 main.py > bot.log 2>&1 &

# 或使用 screen
screen -S bot3
python3 main.py
# 按 Ctrl+A 然后 D 来分离会话
```

## 📋 基本命令测试

### 1. `/start` - 启动命令
- **功能**: 显示欢迎消息和命令帮助
- **权限**: 所有授权用户
- **测试**: 在私聊中发送 `/start`

### 2. `/report` - 查看报表
- **功能**: 显示财务报表
- **权限**: 授权用户
- **测试**: 在私聊中发送 `/report`

### 3. `/search` - 搜索订单
- **功能**: 搜索订单（支持多种搜索方式）
- **权限**: 授权用户
- **测试**: 在私聊中发送 `/search`
- **示例**: 
  - `/search` - 显示搜索菜单
  - `/search state normal` - 按状态搜索

### 4. `/valid_amount` - 有效金额统计
- **功能**: 显示有效金额统计
- **权限**: 授权用户
- **测试**: 在私聊中发送 `/valid_amount`

### 5. `/myreport` - 我的报表
- **功能**: 查看个人报表
- **权限**: 所有用户
- **测试**: 在私聊中发送 `/myreport`

### 6. `/ordertable` - 订单总表
- **功能**: 生成订单总表Excel
- **权限**: 所有用户
- **测试**: 在私聊中发送 `/ordertable`

## 🔍 日志监控

### 查看实时日志
```bash
# 如果使用 tee 保存日志
tail -f bot_runtime.log

# 如果使用 nohup
tail -f bot.log
```

### 日志级别
- **INFO**: 正常操作信息
- **WARNING**: 警告信息（非关键）
- **ERROR**: 错误信息（需要关注）
- **DEBUG**: 调试信息（需要设置 DEBUG=1）

### 关键日志信息
- `机器人启动中...` - 启动成功
- `数据库已就绪` - 数据库连接成功
- `应用创建成功` - Telegram连接成功
- `机器人启动成功，等待消息...` - 准备接收消息

## ⚠️ 常见问题排查

### 1. 机器人未响应
- **检查**: 查看日志是否有错误
- **检查**: 确认 BOT_TOKEN 正确
- **检查**: 确认网络连接正常

### 2. 数据库错误
- **检查**: 确认数据库文件存在
- **检查**: 确认数据库权限正确
- **检查**: 查看日志中的数据库错误信息

### 3. 命令无响应
- **检查**: 确认用户已授权
- **检查**: 确认命令格式正确
- **检查**: 查看日志中的错误信息

## 📊 功能测试清单

### 基础功能
- [ ] `/start` 命令响应
- [ ] `/report` 命令响应
- [ ] `/search` 命令响应
- [ ] `/valid_amount` 命令响应

### 订单管理
- [ ] 创建订单
- [ ] 查看订单
- [ ] 更新订单状态
- [ ] 搜索订单

### 财务管理
- [ ] 查看收入明细
- [ ] 查看支出明细
- [ ] 查看报表

### 群组功能
- [ ] 群名变更自动处理
- [ ] 新成员入群处理
- [ ] 群组消息发送

## 🔧 调试模式

### 启用调试日志
```bash
export DEBUG=1
python3 main.py
```

### 查看详细错误
日志中会显示完整的错误堆栈信息，便于排查问题。

## 📝 注意事项

1. **首次运行**: 确保数据库已初始化
2. **权限设置**: 确保管理员ID已正确配置
3. **网络连接**: 确保可以访问 Telegram API
4. **日志监控**: 定期查看日志，及时发现问题

## 🆘 获取帮助

如果遇到问题：
1. 查看日志文件
2. 检查配置是否正确
3. 查看错误堆栈信息
4. 参考项目文档

