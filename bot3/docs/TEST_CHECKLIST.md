# 测试检查清单

**快速参考指南** - 用于日常测试和发布前检查

---

## 📋 日常测试检查清单

### 每日检查（开发期间）

- [ ] 运行单元测试：`./scripts/run_tests.sh unit`
- [ ] 检查代码风格：`black --check . && isort --check .`
- [ ] 检查导入错误：`python3 -m py_compile **/*.py`
- [ ] 验证数据库初始化：`python3 init_db.py`

### 提交前检查

- [ ] 运行所有单元测试：`./scripts/run_tests.sh unit`
- [ ] 运行集成测试：`./scripts/run_tests.sh integration`
- [ ] 代码格式化：`black . && isort .`
- [ ] 检查代码质量：`pylint bot3/ --disable=C,R,W`
- [ ] 验证无语法错误

---

## 🚀 发布前完整检查清单

### 1. 功能测试

#### 模块1：用户权限管理
- [ ] 员工管理功能正常
- [ ] 归属管理功能正常
- [ ] 用户映射功能正常

#### 模块2：财务管理
- [ ] 收入记录功能正常
- [ ] 支出记录功能正常
- [ ] 支付账户管理正常
- [ ] 资金调整功能正常
- [ ] 余额查询准确

#### 模块3：订单管理
- [ ] 订单创建功能正常
- [ ] 订单状态管理正常
- [ ] 订单金额操作正常
- [ ] 订单查询功能正常

#### 模块4：自动化任务
- [ ] 订单搜索功能正常
- [ ] 付款提醒功能正常
- [ ] 定时任务功能正常
- [ ] 群组消息功能正常

#### 模块5：数据管理
- [ ] 报表生成功能正常
- [ ] Excel导入功能正常
- [ ] 数据诊断功能正常
- [ ] 撤销操作功能正常
- [ ] 每日操作查询正常

#### 模块6：客户信用系统
- [ ] 客户信用管理正常
- [ ] 黑名单管理正常
- [ ] 白名单管理正常

### 2. Excel报表测试

- [ ] 财务报表生成正确
- [ ] 归属报表生成正确
- [ ] 订单总表生成正确
- [ ] 每日变化报表生成正确
- [ ] 报表格式符合要求
- [ ] 数据汇总行正确显示
- [ ] 新/老客户区分正确
- [ ] 本金归还分为订单数和金额
- [ ] 月度汇总正确显示
- [ ] 各单页都有汇总行

### 3. 数据库测试

- [ ] 数据库初始化正常
- [ ] 数据保存正确
- [ ] 数据查询准确
- [ ] 事务处理正常
- [ ] 数据一致性验证通过
- [ ] 备份功能正常
- [ ] 恢复功能正常

### 4. 权限和安全测试

- [ ] 管理员权限验证正常
- [ ] 员工权限验证正常
- [ ] 非授权用户无法访问
- [ ] 敏感信息不泄露
- [ ] SQL注入防护有效

### 5. 性能测试

- [ ] 数据库查询性能正常（< 1秒）
- [ ] Excel生成性能正常（< 30秒）
- [ ] 批量操作性能正常（< 10秒）
- [ ] 并发处理正常

### 6. 自动化任务测试

- [ ] 定时任务正常执行
- [ ] 群组消息正常发送
- [ ] 付款提醒正常发送
- [ ] 每日报表自动生成

### 7. 错误处理测试

- [ ] 无效输入正确处理
- [ ] 错误消息清晰明确
- [ ] 异常情况不会崩溃
- [ ] 数据回滚正常

### 8. 配置和启动测试

- [ ] 配置加载正常
- [ ] 环境变量读取正常
- [ ] Bot启动正常
- [ ] 数据库连接正常
- [ ] 所有处理器注册成功

---

## 📊 测试执行命令

### 快速测试
```bash
# 运行所有测试
./scripts/run_tests.sh all

# 运行单元测试
./scripts/run_tests.sh unit

# 运行集成测试
./scripts/run_tests.sh integration
```

### 完整测试
```bash
# 生成测试报告和覆盖率
./scripts/run_tests.sh report

# 只生成覆盖率报告
./scripts/run_tests.sh coverage
```

### 手动测试命令

```bash
# 启动Bot（测试环境）
export DATA_DIR="./test_data"
export BOT_TOKEN="test_token"
export ADMIN_USER_IDS="123456789"
python3 main.py

# 初始化测试数据库
python3 init_db.py
```

---

## 🔍 测试数据准备

### 基础测试数据

1. **测试用户**
   - 管理员用户ID: 8099345167
   - 测试员工用户ID: 123456789

2. **测试客户**
   - 客户1: 新客户
   - 客户2: 老客户（已有订单）

3. **测试订单**
   - 正常订单
   - 逾期订单
   - 违约订单
   - 完成订单

4. **测试支付账户**
   - GCash账户
   - PayMaya账户

---

## 📝 测试记录模板

### 测试执行记录

**日期**: ___________  
**测试人员**: ___________  
**测试类型**: [ ] 单元测试 [ ] 集成测试 [ ] 功能测试 [ ] E2E测试

**测试结果**:
- 总测试数: ___
- 通过: ___
- 失败: ___
- 跳过: ___

**失败测试**:
1. ________________
2. ________________

**备注**:
_________________________________

---

## ⚠️ 常见问题检查

### Bot无法启动
- [ ] 检查BOT_TOKEN是否设置
- [ ] 检查ADMIN_USER_IDS是否设置
- [ ] 检查数据库文件权限
- [ ] 检查Python依赖是否安装

### 数据库错误
- [ ] 检查数据库文件是否存在
- [ ] 检查数据库文件权限
- [ ] 运行数据库初始化：`python3 init_db.py`
- [ ] 检查数据库连接配置

### 导入错误
- [ ] 检查Python路径配置
- [ ] 检查模块导入路径
- [ ] 检查__init__.py文件
- [ ] 运行：`python3 -c "import bot3"`

### Excel生成错误
- [ ] 检查openpyxl是否安装
- [ ] 检查文件写入权限
- [ ] 检查磁盘空间
- [ ] 检查数据格式

---

## 📚 相关文档

- [完整测试计划](./TEST_PLAN.md)
- [项目README](../README.md)
- [配置说明](../config.py)

---

**最后更新**: 2025-01-28

