# æŒç»­æ”¹è¿›æŒ‡å—

**ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-01-28  
**æœ€åæ›´æ–°**: 2025-01-28

---

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›æŒç»­æ”¹è¿›æµ‹è¯•è¦†ç›–ç‡å’Œä»£ç è´¨é‡çš„æŒ‡å—ã€‚

---

## ğŸ¯ æ”¹è¿›ç›®æ ‡

### çŸ­æœŸç›®æ ‡ï¼ˆ1-2å‘¨ï¼‰

- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 60%
- [ ] æ ¸å¿ƒä¸šåŠ¡é€»è¾‘è¦†ç›–ç‡ > 80%
- [ ] æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡
- [ ] CI/CDå·¥ä½œæµæ­£å¸¸è¿è¡Œ

### ä¸­æœŸç›®æ ‡ï¼ˆ1ä¸ªæœˆï¼‰

- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] é›†æˆæµ‹è¯•è¦†ç›–ç‡ > 70%
- [ ] åŠŸèƒ½æµ‹è¯•è¦†ç›–ä¸»è¦åŠŸèƒ½
- [ ] æ€§èƒ½æµ‹è¯•åŸºå‡†å»ºç«‹

### é•¿æœŸç›®æ ‡ï¼ˆ3ä¸ªæœˆï¼‰

- [ ] æ€»ä½“æµ‹è¯•è¦†ç›–ç‡ > 85%
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•è¦†ç›–ä¸»è¦ç”¨æˆ·åœºæ™¯
- [ ] è‡ªåŠ¨åŒ–æµ‹è¯•åœ¨CI/CDä¸­ç¨³å®šè¿è¡Œ
- [ ] æµ‹è¯•æ‰§è¡Œæ—¶é—´ä¼˜åŒ–

---

## ğŸ“Š å®šæœŸæµ‹è¯•æ‰§è¡Œ

### æ¯æ—¥æ£€æŸ¥

**æ—¶é—´**: æ¯å¤©å¼€å‘å¼€å§‹å‰

**ä»»åŠ¡**:
```bash
cd bot3

# è¿è¡Œå•å…ƒæµ‹è¯•ï¼ˆå¿«é€Ÿï¼‰
./scripts/run_tests.sh unit

# æ£€æŸ¥ä»£ç é£æ ¼
black --check . && isort --check .

# æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡è¶‹åŠ¿
pytest tests/unit/ --cov=. --cov-report=term-missing
```

### æ¯å‘¨å®¡æŸ¥

**æ—¶é—´**: æ¯å‘¨ä¸€

**ä»»åŠ¡**:
```bash
cd bot3

# è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
./scripts/run_tests.sh all

# ç”Ÿæˆå®Œæ•´æµ‹è¯•æŠ¥å‘Š
./scripts/generate_test_report.sh

# å®¡æŸ¥è¦†ç›–ç‡æŠ¥å‘Š
open htmlcov/index.html

# æ£€æŸ¥æœªè¦†ç›–çš„ä»£ç 
pytest --cov=. --cov-report=term-missing | grep "TOTAL"
```

### æ¯æœˆè¯„ä¼°

**æ—¶é—´**: æ¯æœˆç¬¬ä¸€å¤©

**ä»»åŠ¡**:
1. å®¡æŸ¥æµ‹è¯•è¦†ç›–ç‡è¶‹åŠ¿
2. è¯†åˆ«éœ€è¦å¢åŠ æµ‹è¯•çš„æ¨¡å—
3. æ›´æ–°æµ‹è¯•è®¡åˆ’
4. ä¼˜åŒ–æ…¢é€Ÿæµ‹è¯•
5. å®¡æŸ¥å’Œæ›´æ–°æµ‹è¯•æ–‡æ¡£

---

## ğŸ” è¯†åˆ«æµ‹è¯•ç¼ºå£

### ä½¿ç”¨è¦†ç›–ç‡æŠ¥å‘Š

```bash
cd bot3

# ç”Ÿæˆè¯¦ç»†è¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=. --cov-report=html --cov-report=term-missing

# æ‰“å¼€è¦†ç›–ç‡æŠ¥å‘Š
open htmlcov/index.html
```

### æŸ¥æ‰¾æœªè¦†ç›–çš„ä»£ç 

1. æ‰“å¼€è¦†ç›–ç‡æŠ¥å‘Š
2. æŸ¥çœ‹è¦†ç›–ç‡æœ€ä½çš„æ–‡ä»¶
3. è¯†åˆ«æœªè¦†ç›–çš„å‡½æ•°/åˆ†æ”¯
4. æ·»åŠ ç›¸åº”çš„æµ‹è¯•ç”¨ä¾‹

### å…³é”®æ¨¡å—ä¼˜å…ˆçº§

1. **é«˜ä¼˜å…ˆçº§**ï¼ˆå¿…é¡»é«˜è¦†ç›–ç‡ï¼‰:
   - æ•°æ®åº“æ“ä½œï¼ˆdb/ï¼‰
   - ä¸šåŠ¡é€»è¾‘ï¼ˆservices/ï¼‰
   - æ•°æ®éªŒè¯ï¼ˆutils/validation_helpers.pyï¼‰
   - è®¢å•ç®¡ç†ï¼ˆhandlers/module3_order/ï¼‰

2. **ä¸­ä¼˜å…ˆçº§**ï¼ˆå»ºè®®é«˜è¦†ç›–ç‡ï¼‰:
   - å·¥å…·å‡½æ•°ï¼ˆutils/ï¼‰
   - æŠ¥è¡¨ç”Ÿæˆï¼ˆutils/excel_*.pyï¼‰
   - è´¢åŠ¡ç®¡ç†ï¼ˆhandlers/module2_finance/ï¼‰

3. **ä½ä¼˜å…ˆçº§**ï¼ˆåŸºç¡€è¦†ç›–å³å¯ï¼‰:
   - é…ç½®ç®¡ç†ï¼ˆconfig.pyï¼‰
   - è¾…åŠ©å‡½æ•°
   - å·²å……åˆ†æµ‹è¯•çš„ç¬¬ä¸‰æ–¹åº“å°è£…

---

## ğŸ“ æ·»åŠ æ–°æµ‹è¯•ç”¨ä¾‹

### å•å…ƒæµ‹è¯•æ¨¡æ¿

```python
"""æ¨¡å—åç§°å•å…ƒæµ‹è¯•

æµ‹è¯• [æ¨¡å—è·¯å¾„] æ¨¡å—ä¸­çš„å‡½æ•°ã€‚
"""

import pytest

from [æ¨¡å—è·¯å¾„] import [å‡½æ•°å]


def test_[å‡½æ•°å]_[åœºæ™¯]_[é¢„æœŸç»“æœ]():
    """æµ‹è¯• [åœºæ™¯æè¿°]"""
    # Arrange: å‡†å¤‡æµ‹è¯•æ•°æ®
    input_data = ...
    expected_output = ...

    # Act: æ‰§è¡Œè¢«æµ‹è¯•çš„å‡½æ•°
    result = [å‡½æ•°å](input_data)

    # Assert: éªŒè¯ç»“æœ
    assert result == expected_output


def test_[å‡½æ•°å]_[é”™è¯¯åœºæ™¯]_[é¢„æœŸé”™è¯¯]():
    """æµ‹è¯• [é”™è¯¯åœºæ™¯æè¿°]"""
    # Arrange
    invalid_input = ...

    # Act & Assert
    with pytest.raises([å¼‚å¸¸ç±»å‹]):
        [å‡½æ•°å](invalid_input)
```

### é›†æˆæµ‹è¯•æ¨¡æ¿

```python
"""åŠŸèƒ½åç§°é›†æˆæµ‹è¯•

æµ‹è¯• [åŠŸèƒ½] çš„å®Œæ•´æµç¨‹ã€‚
"""

import pytest

from tests.fixtures.database import db_connection, temp_db


@pytest.mark.asyncio
@pytest.mark.integration
async def test_[åŠŸèƒ½]_[åœºæ™¯](temp_db, db_connection):
    """æµ‹è¯• [åœºæ™¯æè¿°]"""
    import init_db

    original_db_name = init_db.DB_NAME
    init_db.DB_NAME = temp_db

    try:
        # 1. å‡†å¤‡æµ‹è¯•æ•°æ®
        cursor = db_connection.cursor()
        # ... è®¾ç½®æµ‹è¯•æ•°æ® ...

        # 2. æ‰§è¡Œæµ‹è¯•æ“ä½œ
        # ... æ‰§è¡Œæ“ä½œ ...

        # 3. éªŒè¯ç»“æœ
        # ... éªŒè¯æ•°æ® ...

    finally:
        init_db.DB_NAME = original_db_name
```

---

## ğŸš€ æµ‹è¯•ä¼˜åŒ–æŠ€å·§

### 1. ä½¿ç”¨Fixturesé¿å…é‡å¤ä»£ç 

```python
@pytest.fixture
def sample_order_data():
    """ç¤ºä¾‹è®¢å•æ•°æ®fixture"""
    return {
        "order_id": "TEST001",
        "group_id": "S01",
        "chat_id": 12345,
        "date": "2025-01-01",
        "weekday_group": "ä¸€",
        "customer": "A",
        "amount": 10000.0,
        "state": "normal",
    }
```

### 2. ä½¿ç”¨å‚æ•°åŒ–æµ‹è¯•

```python
@pytest.mark.parametrize("amount,expected", [
    ("1000.50", 1000.50),
    ("0.01", 0.01),
    ("999999999.99", 999999999.99),
])
def test_validate_amount_valid(amount, expected):
    """æµ‹è¯•æœ‰æ•ˆé‡‘é¢"""
    is_valid, result, error = validate_amount(amount)
    assert is_valid is True
    assert result == expected
```

### 3. ä½¿ç”¨Mockå‡å°‘ä¾èµ–

```python
from unittest.mock import patch, MagicMock

@patch("module.function")
def test_with_mock(mock_function):
    """ä½¿ç”¨mockçš„æµ‹è¯•"""
    mock_function.return_value = "mocked_result"
    result = function_under_test()
    assert result == "expected_result"
    mock_function.assert_called_once()
```

### 4. å¹¶è¡Œæ‰§è¡Œæµ‹è¯•

```bash
# å®‰è£…pytest-xdist
pip install pytest-xdist

# å¹¶è¡Œè¿è¡Œæµ‹è¯•
pytest -n auto
```

---

## ğŸ“ˆ ç›‘æ§æµ‹è¯•æŒ‡æ ‡

### å…³é”®æŒ‡æ ‡

1. **æµ‹è¯•è¦†ç›–ç‡**
   - æ€»ä½“è¦†ç›–ç‡
   - åˆ†æ”¯è¦†ç›–ç‡
   - å‡½æ•°è¦†ç›–ç‡

2. **æµ‹è¯•æ‰§è¡Œæ—¶é—´**
   - å•å…ƒæµ‹è¯•æ€»æ—¶é—´
   - é›†æˆæµ‹è¯•æ€»æ—¶é—´
   - å•ä¸ªæµ‹è¯•å¹³å‡æ—¶é—´

3. **æµ‹è¯•é€šè¿‡ç‡**
   - é€šè¿‡çš„æµ‹è¯•æ•°é‡
   - å¤±è´¥çš„æµ‹è¯•æ•°é‡
   - è·³è¿‡çš„æµ‹è¯•æ•°é‡

4. **ä»£ç è´¨é‡æŒ‡æ ‡**
   - pylintåˆ†æ•°
   - flake8é”™è¯¯æ•°
   - ä»£ç å¤æ‚åº¦

### è·Ÿè¸ªæŒ‡æ ‡

åˆ›å»ºæµ‹è¯•æŒ‡æ ‡è·Ÿè¸ªæ–‡æ¡£ï¼š

```markdown
# æµ‹è¯•æŒ‡æ ‡è·Ÿè¸ª

## 2025-01-28
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡: 47% (validation_helpers.py)
- æµ‹è¯•æ‰§è¡Œæ—¶é—´: ~0.5ç§’ (å•å…ƒæµ‹è¯•)
- æµ‹è¯•é€šè¿‡ç‡: 19/19 (100%)

## 2025-02-01
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡: 60%
- æµ‹è¯•æ‰§è¡Œæ—¶é—´: ~2ç§’ (å•å…ƒæµ‹è¯•)
- æµ‹è¯•é€šè¿‡ç‡: 50/50 (100%)
```

---

## ğŸ”„ æŒç»­æ”¹è¿›æµç¨‹

### æ¯å‘¨æµç¨‹

1. **å‘¨ä¸€**ï¼šè¿è¡Œå®Œæ•´æµ‹è¯•ï¼Œç”ŸæˆæŠ¥å‘Š
2. **å‘¨äºŒ-å‘¨å››**ï¼šå¼€å‘æ–°åŠŸèƒ½ï¼Œæ·»åŠ æµ‹è¯•
3. **å‘¨äº”**ï¼šå®¡æŸ¥æµ‹è¯•è¦†ç›–ç‡ï¼Œè¯†åˆ«ç¼ºå£
4. **å‘¨æœ«**ï¼šä¿®å¤æµ‹è¯•é—®é¢˜ï¼Œä¼˜åŒ–æµ‹è¯•

### æ¯æœˆæµç¨‹

1. **ç¬¬ä¸€å‘¨**ï¼šè¯„ä¼°æµ‹è¯•è¦†ç›–ç‡è¶‹åŠ¿
2. **ç¬¬äºŒå‘¨**ï¼šé‡ç‚¹æ”¹è¿›ä½è¦†ç›–ç‡æ¨¡å—
3. **ç¬¬ä¸‰å‘¨**ï¼šä¼˜åŒ–æ…¢é€Ÿæµ‹è¯•
4. **ç¬¬å››å‘¨**ï¼šå®¡æŸ¥å’Œæ›´æ–°æµ‹è¯•æ–‡æ¡£

### æ¯å­£åº¦æµç¨‹

1. å…¨é¢å®¡æŸ¥æµ‹è¯•ç­–ç•¥
2. è¯„ä¼°æµ‹è¯•å·¥å…·å’Œæ¡†æ¶
3. æ›´æ–°æµ‹è¯•è®¡åˆ’å’Œç›®æ ‡
4. åˆ†äº«æœ€ä½³å®è·µ

---

## ğŸ› ï¸ å·¥å…·å’Œèµ„æº

### æµ‹è¯•å·¥å…·

- **pytest**: æµ‹è¯•æ¡†æ¶
- **pytest-cov**: è¦†ç›–ç‡å·¥å…·
- **pytest-xdist**: å¹¶è¡Œæ‰§è¡Œ
- **pytest-html**: HTMLæŠ¥å‘Š
- **pytest-asyncio**: å¼‚æ­¥æµ‹è¯•æ”¯æŒ

### ä»£ç è´¨é‡å·¥å…·

- **black**: ä»£ç æ ¼å¼åŒ–
- **isort**: å¯¼å…¥æ’åº
- **pylint**: ä»£ç è´¨é‡æ£€æŸ¥
- **flake8**: ä»£ç é£æ ¼æ£€æŸ¥
- **bandit**: å®‰å…¨æ‰«æ

### æ–‡æ¡£èµ„æº

- [pytestæ–‡æ¡£](https://docs.pytest.org/)
- [æµ‹è¯•é©±åŠ¨å¼€å‘æŒ‡å—](https://en.wikipedia.org/wiki/Test-driven_development)
- [Pythonæµ‹è¯•æœ€ä½³å®è·µ](https://docs.python-guide.org/writing/tests/)

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æµ‹è¯•è®¡åˆ’](./TEST_PLAN.md)
- [æµ‹è¯•æ£€æŸ¥æ¸…å•](./TEST_CHECKLIST.md)
- [æµ‹è¯•å®æ–½è¯´æ˜](./TEST_IMPLEMENTATION.md)
- [CI/CDæŒ‡å—](./CICD_GUIDE.md)

---

## âœ… æ£€æŸ¥æ¸…å•

### æ—¥å¸¸æ£€æŸ¥

- [ ] è¿è¡Œå•å…ƒæµ‹è¯•
- [ ] æ£€æŸ¥ä»£ç é£æ ¼
- [ ] éªŒè¯æ–°ä»£ç æœ‰æµ‹è¯•è¦†ç›–

### æ¯å‘¨æ£€æŸ¥

- [ ] è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
- [ ] ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
- [ ] å®¡æŸ¥è¦†ç›–ç‡
- [ ] ä¿®å¤å¤±è´¥çš„æµ‹è¯•

### æ¯æœˆæ£€æŸ¥

- [ ] è¯„ä¼°æµ‹è¯•è¦†ç›–ç‡è¶‹åŠ¿
- [ ] è¯†åˆ«æµ‹è¯•ç¼ºå£
- [ ] ä¼˜åŒ–æ…¢é€Ÿæµ‹è¯•
- [ ] æ›´æ–°æµ‹è¯•æ–‡æ¡£

---

**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025-01-28

