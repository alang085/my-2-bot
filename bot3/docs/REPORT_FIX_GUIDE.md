# 报表访问问题修复指南

## 🔍 问题诊断结果

根据数据库检查，发现以下问题：

### ❌ 问题1: 没有授权用户
- **当前状态**: `authorized_users` 表为空
- **影响**: 非管理员用户无法使用 `/report` 命令
- **错误消息**: "⚠️ Permission denied."

### ❌ 问题2: 没有用户归属映射
- **当前状态**: `user_group_mapping` 表为空
- **影响**: 用户无法使用 `/myreport` 命令
- **错误消息**: "❌ 您没有权限查看任何归属ID的报表"

## ✅ 解决方案

### 方案1: 使用 `/report` 命令（推荐）

**适用场景**: 管理员或需要查看所有数据的员工

**步骤**:
1. **如果是管理员**: 直接使用 `/report` 命令即可（用户ID: 8099345167 已在管理员列表中）

2. **如果是普通用户**: 需要管理员先添加为员工
   ```
   管理员执行: /add_employee <用户ID>
   ```
   然后就可以使用 `/report` 命令了

### 方案2: 使用 `/myreport` 命令

**适用场景**: 普通用户，只需要查看自己归属ID的报表

**步骤**:
1. **管理员为用户分配归属ID**:
   ```
   管理员执行: /set_user_group_id <用户ID> <归属ID>
   ```
   例如: `/set_user_group_id 123456789 S01`

2. **用户使用命令**:
   ```
   /myreport
   ```

## 📋 快速修复步骤

### 如果您是管理员（用户ID: 8099345167）

您可以直接使用 `/report` 命令，无需额外配置。

### 如果您是普通用户

请让管理员执行以下操作：

1. **添加为员工**（用于 `/report`）:
   ```
   /add_employee <您的用户ID>
   ```

2. **分配归属ID**（用于 `/myreport`）:
   ```
   /set_user_group_id <您的用户ID> <归属ID>
   ```
   归属ID示例: S01, S02, S03 等

## 🔧 如何获取您的用户ID

在 Telegram 中：
1. 发送任意消息给机器人
2. 查看机器人日志，找到您的用户ID
3. 或者使用第三方机器人（如 @userinfobot）获取您的用户ID

## 📊 验证修复

修复后，测试以下命令：

1. **检查权限**:
   ```
   /check_permission
   ```
   应该显示您的权限状态和归属ID

2. **测试报表**:
   ```
   /report    # 需要授权
   /myreport  # 需要归属ID
   ```

## 🎯 命令说明

### `/report` 命令
- **权限要求**: 管理员或授权员工
- **功能**: 显示全局报表（所有归属ID）
- **按钮**: 月报、日期查询、开销录入等

### `/myreport` 命令
- **权限要求**: 需要分配归属ID
- **功能**: 显示用户归属ID的报表
- **按钮**: 月报、日期查询（仅限该归属ID）

## ⚠️ 注意事项

1. **管理员**: 用户ID 8099345167 已在管理员列表中，可以直接使用所有命令
2. **普通用户**: 需要管理员配置权限后才能使用
3. **归属ID**: 必须是已存在的归属ID（如 S01, S02 等）

## 📞 需要帮助？

如果问题仍然存在：
1. 检查机器人是否正常运行
2. 查看日志文件 `bot_runtime.log`
3. 确认用户ID是否正确
4. 确认归属ID是否存在

